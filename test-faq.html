<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQ Update Test</title>
</head>
<body>
    <h1>FAQ Update Test Page</h1>
    <p>This page tests the FAQ updater functionality.</p>
    
    <div id="test-output" style="background: #f0f0f0; padding: 20px; margin: 20px; border-radius: 8px;">
        <h2>Console Output:</h2>
        <pre id="console-log" style="font-family: monospace; font-size: 12px;"></pre>
    </div>
    
    <script>
        // Override console.log to display in the page
        const originalLog = console.log;
        const logOutput = document.getElementById('console-log');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            logOutput.textContent += message + '\n';
        };
    </script>
    
    <!-- Load the FAQ updater module directly -->
    <script type="module">
        import { initializeFAQUpdater } from './assets/js/src/components/faq-updater.js';
        
        console.log('Loading FAQ updater...');
        
        // Initialize the FAQ updater
        const cleanup = initializeFAQUpdater();
        
        // After 3 seconds, search for all h3 elements
        setTimeout(() => {
            console.log('\n=== Searching for H3 elements ===');
            const allH3s = document.querySelectorAll('h3');
            console.log(`Found ${allH3s.length} h3 elements`);
            
            allH3s.forEach((h3, index) => {
                console.log(`H3 ${index}: "${h3.textContent.trim()}"`);
                console.log(`  Classes: ${h3.className}`);
                console.log(`  Parent classes: ${h3.parentElement?.className || 'none'}`);
            });
            
            console.log('\n=== Searching for FAQ text directly ===');
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        const text = node.nodeValue?.trim() || '';
                        if (text.includes('Primary Care') || 
                            text.includes('consultation cost') ||
                            text.includes('preventive check-ups')) {
                            return NodeFilter.FILTER_ACCEPT;
                        }
                        return NodeFilter.FILTER_REJECT;
                    }
                }
            );
            
            let textNode;
            let count = 0;
            while (textNode = walker.nextNode()) {
                count++;
                console.log(`Found text: "${textNode.nodeValue.trim()}"`);
                console.log(`  Parent tag: ${textNode.parentElement?.tagName}`);
                console.log(`  Parent classes: ${textNode.parentElement?.className}`);
            }
            
            if (count === 0) {
                console.log('No FAQ text found on this page');
            }
        }, 3000);
        
        // Load the index page content in an iframe
        const iframe = document.createElement('iframe');
        iframe.src = './index.html';
        iframe.style.width = '100%';
        iframe.style.height = '600px';
        iframe.style.border = '1px solid #ccc';
        iframe.style.marginTop = '20px';
        
        iframe.onload = function() {
            console.log('\n=== Index page loaded in iframe ===');
            
            // Try to access iframe content (may be blocked by same-origin policy)
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const iframeH3s = iframeDoc.querySelectorAll('h3');
                console.log(`Iframe has ${iframeH3s.length} h3 elements`);
                
                // Search for FAQ questions
                const faqQuestions = Array.from(iframeH3s).filter(h3 => 
                    h3.textContent.includes('?')
                );
                
                console.log(`Found ${faqQuestions.length} question h3s`);
                faqQuestions.forEach((h3, index) => {
                    console.log(`FAQ ${index}: "${h3.textContent.trim()}"`);
                    console.log(`  Classes: ${h3.className}`);
                });
            } catch (e) {
                console.log('Cannot access iframe content (cross-origin restriction)');
            }
        };
        
        document.body.appendChild(iframe);
    </script>
</body>
</html>